<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging Revise · Revise.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Revise.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Revise.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../cookbook/">Revise usage: a cookbook</a></li><li><a class="tocitem" href="../limitations/">Limitations</a></li><li class="is-active"><a class="tocitem" href>Debugging Revise</a><ul class="internal"><li><a class="tocitem" href="#Handling-errors-1"><span>Handling errors</span></a></li><li><a class="tocitem" href="#The-logging-framework-1"><span>The logging framework</span></a></li><li><a class="tocitem" href="#Debugging-problems-with-paths-1"><span>Debugging problems with paths</span></a></li></ul></li><li><a class="tocitem" href="../internals/">How Revise works</a></li><li><a class="tocitem" href="../user_reference/">User reference</a></li><li><a class="tocitem" href="../dev_reference/">Developer reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Debugging Revise</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging Revise</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/timholy/Revise.jl/blob/master/docs/src/debugging.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging-Revise-1"><a class="docs-heading-anchor" href="#Debugging-Revise-1">Debugging Revise</a><a class="docs-heading-anchor-permalink" href="#Debugging-Revise-1" title="Permalink"></a></h1><h2 id="Handling-errors-1"><a class="docs-heading-anchor" href="#Handling-errors-1">Handling errors</a><a class="docs-heading-anchor-permalink" href="#Handling-errors-1" title="Permalink"></a></h2><p>Revise attempts to make error reports mimic Julia&#39;s own stacktraces, and as a consequence it has to prevent stacktraces from containing lots of lines pointing to Revise&#39;s own code. If you&#39;re trying to debug a Revise error, you&#39;d probably prefer to see the entire stacktrace. You can uncomment the obvious commented-out line in <a href="../dev_reference/#Revise.trim_toplevel!"><code>Revise.trim_toplevel!</code></a>.</p><h2 id="The-logging-framework-1"><a class="docs-heading-anchor" href="#The-logging-framework-1">The logging framework</a><a class="docs-heading-anchor-permalink" href="#The-logging-framework-1" title="Permalink"></a></h2><p>If Revise isn&#39;t behaving the way you expect it to, it can be useful to examine the decisions it made. Revise supports Julia&#39;s <a href="https://docs.julialang.org/en/v1/stdlib/Logging/">Logging framework</a> and can optionally record its decisions in a format suitable for later inspection. What follows is a simple series of steps you can use to turn on logging, capture messages, and then submit them with a bug report. Alternatively, more advanced developers may want to examine the logs themselves to determine the source of Revise&#39;s error, and for such users a few tips about interpreting the log messages are also provided below.</p><h3 id="Turning-on-logging-1"><a class="docs-heading-anchor" href="#Turning-on-logging-1">Turning on logging</a><a class="docs-heading-anchor-permalink" href="#Turning-on-logging-1" title="Permalink"></a></h3><p>Currently, the best way to turn on logging is within a running Julia session:</p><pre><code class="language-julia-repl">julia&gt; rlogger = Revise.debug_logger()
Revise.ReviseLogger(Revise.LogRecord[], Debug)</code></pre><p>You&#39;ll use <code>rlogger</code> at the end to retrieve the logs.</p><p>Now carry out the series of julia commands and code edits that reproduces the problem.</p><h3 id="Capturing-the-logs-and-submitting-them-with-your-bug-report-1"><a class="docs-heading-anchor" href="#Capturing-the-logs-and-submitting-them-with-your-bug-report-1">Capturing the logs and submitting them with your bug report</a><a class="docs-heading-anchor-permalink" href="#Capturing-the-logs-and-submitting-them-with-your-bug-report-1" title="Permalink"></a></h3><p>Once all the revisions have been triggered and the mistake has been reproduced, it&#39;s time to capture the logs. To capture all the logs, use</p><pre><code class="language-julia">julia&gt; using Base.CoreLogging: Debug

julia&gt; logs = filter(r-&gt;r.level==Debug, rlogger.logs);</code></pre><p>You can capture just the changes that Revise made to running code with</p><pre><code class="language-julia">julia&gt; logs = Revise.actions(rlogger)</code></pre><p>You can either let these print to the console and copy/paste the text output into the issue, or if they are extensive you can save <code>logs</code> to a file:</p><pre><code class="language-julia">open(&quot;/tmp/revise.logs&quot;, &quot;w&quot;) do io
    for log in logs
        println(io, log)
    end
end</code></pre><p>Then you can upload the logs somewhere (e.g., https://gist.github.com/) and link the url in your bug report. To assist in the resolution of the bug, please also specify additional relevant information such as the name of the function that was misbehaving after revision and/or any error messages that your received.</p><p>See also <a href="#A-complete-debugging-demo-1">A complete debugging demo</a> below.</p><h3 id="Logging-by-default-1"><a class="docs-heading-anchor" href="#Logging-by-default-1">Logging by default</a><a class="docs-heading-anchor-permalink" href="#Logging-by-default-1" title="Permalink"></a></h3><p>If you suspect a bug in Revise but have difficulty isolating it, you can include the lines</p><pre><code class="language-julia">    # Turn on logging
    Revise.debug_logger()</code></pre><p>within the <code>Revise</code> block of your <code>~/.julia/config/startup.jl</code> file. This will ensure that you always log Revise&#39;s actions. Then carry out your normal Julia development. If a Revise-related problem arises, executing these lines</p><pre><code class="language-julia">rlogger = Revise.debug_logger()
using Base.CoreLogging: Debug
logs = filter(r-&gt;r.level==Debug, rlogger.logs)
open(&quot;/tmp/revise.logs&quot;, &quot;w&quot;) do io
    for log in logs
        println(io, log)
    end
end</code></pre><p>within the same session will generate the <code>/tmp/revise.logs</code> file that you can submit with your bug report. (What makes this possible is that a second call to <code>Revise.debug_logger()</code> returns the same logger object created by the first call–it is not necessary to hold on to <code>rlogger</code>.)</p><h3 id="The-structure-of-the-logs-1"><a class="docs-heading-anchor" href="#The-structure-of-the-logs-1">The structure of the logs</a><a class="docs-heading-anchor-permalink" href="#The-structure-of-the-logs-1" title="Permalink"></a></h3><p>For those who want to do a little investigating on their own, it may be helpful to know that Revise&#39;s core decisions are captured in the group called &quot;Action,&quot; and they come in three flavors:</p><ul><li>log entries with message <code>&quot;Eval&quot;</code> signify a call to <code>eval</code>; for these events, keyword <code>:deltainfo</code> has value <code>(mod, expr)</code> where <code>mod</code> is the module of evaluation and <code>expr</code> is a <a href="../dev_reference/#Revise.RelocatableExpr"><code>Revise.RelocatableExpr</code></a> containing the expression that was evaluated.</li><li>log entries with message <code>&quot;DeleteMethod&quot;</code> signify a method deletion; for these events, keyword <code>:deltainfo</code> has value <code>(sigt, methsummary)</code> where <code>sigt</code> is the signature of the method that Revise <em>intended</em> to delete and <code>methsummary</code> is a <a href="../dev_reference/#Revise.MethodSummary"><code>MethodSummary</code></a> of the method that Revise actually found to delete.</li><li>log entries with message <code>&quot;LineOffset&quot;</code> correspond to updates to Revise&#39;s own internal estimates of how far a given method has become displaced from the line number it occupied when it was last evaluated. For these events, <code>:deltainfo</code> has value <code>(sigt, newlineno, oldoffset=&gt;newoffset)</code>.</li></ul><p>If you&#39;re debugging mistakes in method creation/deletion, the <code>&quot;LineOffset&quot;</code> events may be distracting; by default <a href="../user_reference/#Revise.actions"><code>Revise.actions</code></a> excludes these events.</p><p>Note that Revise records the time of each revision, which can sometimes be useful in determining which revisions occur in conjunction with which user actions. If you want to make use of this, it can be handy to capture the start time with <code>tstart = time()</code> before commencing on a session.</p><p>See <a href="../user_reference/#Revise.debug_logger"><code>Revise.debug_logger</code></a> for information on groups besides &quot;Action.&quot;</p><h3 id="A-complete-debugging-demo-1"><a class="docs-heading-anchor" href="#A-complete-debugging-demo-1">A complete debugging demo</a><a class="docs-heading-anchor-permalink" href="#A-complete-debugging-demo-1" title="Permalink"></a></h3><p>From within Revise&#39;s <code>test/</code> directory, try the following:</p><pre><code class="language-julia">julia&gt; rlogger = Revise.debug_logger();

shell&gt; cp revisetest.jl /tmp/

julia&gt; includet(&quot;/tmp/revisetest.jl&quot;)

julia&gt; ReviseTest.cube(3)
81

shell&gt; cp revisetest_revised.jl /tmp/revisetest.jl

julia&gt; ReviseTest.cube(3)
27

julia&gt; rlogger.logs
julia&gt; rlogger.logs
9-element Array{Revise.LogRecord,1}:
 Revise.LogRecord(Debug, DeleteMethod, Action, Revise_4ac0f476, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 226, (time=1.557996459055345e9, deltainfo=(Tuple{typeof(Main.ReviseTest.cube),Any}, MethodSummary(:cube, :ReviseTest, Symbol(&quot;/tmp/revisetest.jl&quot;), 7, Tuple{typeof(Main.ReviseTest.cube),Any}))))
 Revise.LogRecord(Debug, DeleteMethod, Action, Revise_4ac0f476, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 226, (time=1.557996459167895e9, deltainfo=(Tuple{typeof(Main.ReviseTest.Internal.mult3),Any}, MethodSummary(:mult3, :Internal, Symbol(&quot;/tmp/revisetest.jl&quot;), 12, Tuple{typeof(Main.ReviseTest.Internal.mult3),Any}))))
 Revise.LogRecord(Debug, DeleteMethod, Action, Revise_4ac0f476, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 226, (time=1.557996459167956e9, deltainfo=(Tuple{typeof(Main.ReviseTest.Internal.mult4),Any}, MethodSummary(:mult4, :Internal, Symbol(&quot;/tmp/revisetest.jl&quot;), 13, Tuple{typeof(Main.ReviseTest.Internal.mult4),Any}))))
 Revise.LogRecord(Debug, Eval, Action, Revise_9147188b, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 276, (time=1.557996459259605e9, deltainfo=(Main.ReviseTest, :(cube(x) = begin
          #= /tmp/revisetest.jl:7 =#
          x ^ 3
      end))))
 Revise.LogRecord(Debug, Eval, Action, Revise_9147188b, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 276, (time=1.557996459330512e9, deltainfo=(Main.ReviseTest, :(fourth(x) = begin
          #= /tmp/revisetest.jl:9 =#
          x ^ 4
      end))))
 Revise.LogRecord(Debug, LineOffset, Action, Revise_fb38a7f7, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 296, (time=1.557996459331061e9, deltainfo=(Any[Tuple{typeof(mult2),Any}], :(#= /tmp/revisetest.jl:11 =#) =&gt; :(#= /tmp/revisetest.jl:13 =#))))
 Revise.LogRecord(Debug, Eval, Action, Revise_9147188b, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 276, (time=1.557996459391182e9, deltainfo=(Main.ReviseTest.Internal, :(mult3(x) = begin
          #= /tmp/revisetest.jl:14 =#
          3x
      end))))
 Revise.LogRecord(Debug, LineOffset, Action, Revise_fb38a7f7, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 296, (time=1.557996459391642e9, deltainfo=(Any[Tuple{typeof(unchanged),Any}], :(#= /tmp/revisetest.jl:18 =#) =&gt; :(#= /tmp/revisetest.jl:19 =#))))
 Revise.LogRecord(Debug, LineOffset, Action, Revise_fb38a7f7, &quot;/home/tim/.julia/dev/Revise/src/Revise.jl&quot;, 296, (time=1.557996459391695e9, deltainfo=(Any[Tuple{typeof(unchanged2),Any}], :(#= /tmp/revisetest.jl:20 =#) =&gt; :(#= /tmp/revisetest.jl:21 =#))))</code></pre><p>You can see that Revise started by deleting three methods, followed by evaluating three new versions of those methods. Interspersed are various changes to the line numbering.</p><p>In rare cases it might be helpful to independently record the sequence of edits to the file. You can make copies <code>cp editedfile.jl &gt; /tmp/version1.jl</code>, edit code, <code>cp editedfile.jl &gt; /tmp/version2.jl</code>, etc. <code>diff version1.jl version2.jl</code> can be used to capture a compact summary of the changes and pasted into the bug report.</p><h2 id="Debugging-problems-with-paths-1"><a class="docs-heading-anchor" href="#Debugging-problems-with-paths-1">Debugging problems with paths</a><a class="docs-heading-anchor-permalink" href="#Debugging-problems-with-paths-1" title="Permalink"></a></h2><p>During certain types of usage you might receive messages like</p><pre><code class="language-julia">Warning: /some/system/path/stdlib/v1.0/SHA/src is not an existing directory, Revise is not watching</code></pre><p>Unless you&#39;ve just deleted that directory, this indicates that some of Revise&#39;s functionality is broken.</p><p>In the majority of cases, failures come down to Revise having trouble locating source code on your drive. This problem should be fixable, because Revise includes functionality to update its links to source files, as long as it knows what to do.</p><p>One of the best approaches is to run Revise&#39;s own tests via <code>pkg&gt; test Revise</code>. Here are some possible test warnings and errors, and steps you might take to fix them:</p><ul><li><code>Base &amp; stdlib file paths: Test Failed at /some/path...  Expression: isfile(Revise.basesrccache)</code> This failure is quite serious, and indicates that you will be unable to access code in <code>Base</code>. To fix this, look for a file called <code>&quot;base.cache&quot;</code> somewhere in your Julia install or build directory (for the author, it is at <code>/home/tim/src/julia-1.0/usr/share/julia/base.cache</code>). Now compare this with the value of <code>Revise.basesrccache</code>. (If you&#39;re getting this failure, presumably they are different.) An important &quot;top level&quot; directory is <code>Sys.BINDIR</code>; if they differ already at this level, consider adding a symbolic link from the location pointed at by <code>Sys.BINDIR</code> to the corresponding top-level directory in your actual Julia installation. You&#39;ll know you&#39;ve succeeded in specifying it correctly when, after restarting Julia, <code>Revise.basesrccache</code> points to the correct file and <code>Revise.juliadir</code> points to the directory that contains <code>base/</code>. If this workaround is not possible or does not succeed, please <a href="https://github.com/timholy/Revise.jl/issues">file an issue</a> with a description of why you can&#39;t use it and/or<ul><li>details from <code>versioninfo</code> and information about how you obtained your Julia installation;</li><li>the values of <code>Revise.basesrccache</code> and <code>Revise.juliadir</code>, and the actual paths to <code>base.cache</code> and the directory containing the running Julia&#39;s <code>base/</code>;</li><li>what you attempted when trying to fix the problem;</li><li>if possible, your best understanding of why this failed to fix it.</li></ul></li><li><code>skipping Core.Compiler tests due to lack of git repo</code>: this likely indicates that you downloaded a Julia binary rather than building Julia from source. While Revise should be able to access the code in <code>Base</code> and standard libraries, at the current time it is not possible for Revise to access julia&#39;s Core.Compiler module unless you clone Julia&#39;s repository and build it from source.</li><li><code>skipping git tests because Revise is not under development</code>: this warning should be harmless. Revise has built-in functionality for extracting source code using <code>git</code>, and it uses itself (i.e., its own git repository) for testing purposes. These tests run only if you have checked out Revise for development (<code>pkg&gt; dev Revise</code>) or on the continuous integration servers (Travis and Appveyor).</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../limitations/">« Limitations</a><a class="docs-footer-nextpage" href="../internals/">How Revise works »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 21 December 2020 00:24">Monday 21 December 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
